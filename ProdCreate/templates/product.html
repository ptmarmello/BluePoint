{% load pwa %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dart - page</title>
  <meta name="keywords" content="Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod.">
  <meta name="description" content="Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod.">
  
  <link rel="stylesheet" href="{% static 'assets/bootstrap/css/bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'assets/flat-icon/flaticon.css' %}">
  <link rel="stylesheet" href="{% static 'temp/styles/styles.css' %}">

  <!-- Animate.css -->
  <link rel="stylesheet" href="{% static 'css/animate.css' %}">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin=""/>

  <style type="text/css">

    #mapInst{
        height: 100%;
        width: 100%;
      }
  /* The Modal (background) */
.modalMap {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 10vh; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modalMap-content {
  background-color: #fefefe;
  position: fixed;
  margin: auto;
  padding: 10px;
  border: 1px solid #888;
  width: 100%;
  height: 80%;
}

/* The Close Button */
.close {
  color: #aaaaaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

.modalPopup {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modalPopup-content {
  background-color: #fefefe;
  margin: auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
}

.loader {
  border: 0.4vw solid #f3f3f3;
  border-radius: 100%;
  border-top: 2.0vw solid #3498db;
  /*background: #f3f3f3;*/
  
  width: 10vw;
  height: 10vw;
  -webkit-animation: spin 2s linear; /* Safari */
  animation: spin 2s linear infinite;
}

/* Safari */
@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>

<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
   integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
   crossorigin=""></script>

</head>



<body>
  {% progressive_web_app_meta %}
  <div class="main-wrapper">

    <nav class="navbar-default navbar-fixed-top">
          <div class="bluepoint-nav">
            <img class="img-responsive" style="width: 50vw; margin-left: 25vw" src="{% static 'logo.png' %}" alt="">
          </div>
    </nav>



    <!-- NavBar Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<div class="icon-bar navbar-fixed-bottom">
 <!-- ICON 1 --> <a href="{% url 'home' %}"><i class="fa fa-home"></i></a>
 <!-- ICON 2 --> <a class="active" href="{% url 'prodlist' %}"><i class="glyphicon glyphicon-menu-hamburger"></i></a>
 <!-- ICON 3 --> <a href="{% url 'walletpage' user.name %}"><i class="fa fa-user"></i></a>
 <!-- ICON 4 --> <a href="{% url 'userconfig' user.name %}"><i class="glyphicon glyphicon-cog "></i></a>
</div>

<div class="thumbnail" style="margin: 0px 0px 0px 0px; padding-top: 50px;">
    
      <img class="img-responsive" src="{% static 'assets/images/kangoo.png' %}" alt="">
    
</div>
  <div class="container">
    <section class="about">
      <div class="container">
        <div class="page-section">
          <div class="row gutters-50">
            <div class="about--narrow">
              <div class="col-md-6">
              
              <div style="text-align: justify;" class="col-md-6 about__extra-padding">
                <h3 class="about__content-title">{{produtos.name}} </h3>
                <p class="about__content-subTitle">Esse é um dos Produtos desenvolvidos pela Seguradora: {{produtos.belongs_to}}.</p>
                  <p class="about__content-paragraph">{{produtos.product_desc}}.
                    {{produtos}}
                  </p>
                  <!-- <form action="{{ 'user.products.add(produtos.id)' }}" >
 -->                    {% csrf_token %}
                    <button class="button--light" id="addProd"  style="float:right;">CONTRATAR</button>
                    <button class="button--light" id="sinProd"  style="float:right; background-color: red; width: 40vw;"><a href="#">SINISTRO</a></button>
                  <!-- </form> -->
                </div>
              </div>
              </div>
            </div>
          </div>
        </div>
      </section>

            <h2 class="page-section__title" style="text-align: center;">Este produto usará as seguintes informações:</h2>

<section class="service">
      <div class="container">
        <div class="page-section text-center">
          <div class="row gutters-40">

        {% if produtos.gps_location %}
            <div class="col-md-4"  id="mapModalBtn">
              <div class="thumbnail">
                <i class="material-icons">navigation</i>
                <h4 class="service__title">Localização</h4>
                <p class="service__paragraph">Lorem ing elit, sed do eiusmod tempor incididunt</p>
                <div id="myModalMap" class="modalMap">
                  <!-- Modal content -->
                  <div class="modalMap-content">
                      <!-- <span class="close" id="closeModal">&times;</span> -->
                      <!-- <h4>Vou deixar com texto por enquanto.</h4> -->
                      <div id="mapInst"></div> 

                  </div>
              </div>
              </div>
            </div>
        {% endif %}

        {% if produtos.timer_disposal %}
            <div class="col-md-4">
              <div class="thumbnail">
                <i class="material-icons">directions_walk</i>
                <h4 class="service__title">Salve Tempo</h4>
                <p class="service__paragraph">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt</p>
              </div>
            </div>
          {% endif %}

          {% if produtos.preco_display %}
            <div class="col-md-4">
              <div class="thumbnail" id="popupModalBtn">
                <i class="material-icons">credit_card</i>
                <h4 class="service__title">Saiba quanto está pagando</h4>
                <p class="service__paragraph">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt</p>
                  <div id="myModalPopup" class="modalPopup">
                  <!-- Modal content -->
                  <div class="modalPopup-content">
                      <h4>B$ {{produtos.preco_total}},00</h4><h5>Isso tudo usando 30 dias!!!!</h5>
                  </div>
              </div>
            </div>
          </div>
          {% endif %}

          {% if produtos.map_structure %}
          
            <div class="col-md-4">
              <div class="thumbnail" id="mapModalBtn">
                <i class="material-icons">explore</i>
                <h4 class="service__title">Mapa!</h4>
                <p class="service__paragraph">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt</p>
                
                <!-- The Modal -->
                <div id="myModalMap" class="modalMap">
                  <!-- Modal content -->
                  <div class="modalMap-content">
                      <!-- <span class="close" id="closeModal">&times;</span> -->
                      <!-- <h4>Vou deixar com texto por enquanto.</h4> -->
                      <div id="mapInst"></div> 

                  </div>
              </div>
              </div>
            </div>
        
            {% endif %}
            
          </div>
        </div>
      </div>
    </section>
</div>
<script>

var addProd = document.getElementById("addProd");
addProd.onclick = function(){
  console.log("ate aqui vai");

}

// Get the modal
var modalMap = document.getElementById("myModalMap");
var modalPopup = document.getElementById("myModalPopup");

// Get the button that opens the modal
var ModalMapbtn = document.getElementById("mapModalBtn");
var ModalPopupbtn = document.getElementById("popupModalBtn");

// When the user clicks the button, open the modal 
ModalMapbtn.onclick = function() {
  modalMap.style.display = "block";
}
ModalPopupbtn.onclick = function() {
  modalPopup.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
// span.onclick = function() {
//   modal.style.display = "none";
// }

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modalMap) {
    modalMap.style.display = "none";
  }
  else if(event.target == modalPopup){
    modalPopup.style.display= "none";
  }
}
</script>
<script>

  var mymap = L.map('mapInst').locate({setView:true,maxZoom:19});

  L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
    maxZoom: 22,
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
      '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
      'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
    id: 'mapbox/streets-v11'
  }).addTo(mymap);

  function onLocationFound(e) {
    //var radius = e.accuracy;
    var radius = 20;
    L.marker(e.latlng).addTo(mymap).bindPopup("Você está a aproximadamente " + radius + " metros deste ponto.").openPopup();

    L.circle(e.latlng, radius).addTo(mymap);
  }

mymap.on('locationfound', onLocationFound);

/*
  L.circle([51.508, -0.11], 500, {
    color: 'red',
    fillColor: '#f03',
    fillOpacity: 0.5
  }).addTo(mymap).bindPopup("You're safe here.");

  L.polygon([
    [51.509, -0.08],
    [51.503, -0.06],
    [51.51, -0.047]
  ]).addTo(mymap).bindPopup("Safe Area.");
*/

  var circleIcon = L.icon({
    iconUrl: 'https://i.ibb.co/S01CMpG/aim-2.png',
    //shadowUrl: 'leaf-shadow.png',

    iconSize:     [60, 60], // size of the icon
    //shadowSize:   [50, 64], // size of the shadow
    iconAnchor:   [30, 30], // point of the icon which will correspond to marker's location
    //shadowAnchor: [4, 62],  // the same for the shadow
    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
  });

  var popup = L.popup();

  function onMapClick(e) {

    if(confirm("Deseja definir como um lugar Seguro?")){

    popup
      .setLatLng(e.latlng)
      .setContent("Safe Location Defined.")
      .openOn(mymap);
    

      L.marker(e.latlng, {icon: circleIcon}).addTo(mymap);
      L.circle(e.latlng, 60, {
        color: 'green',
        //fillColor: '#f03',
        fillOpacity: 0.5
      })
    
      .addTo(mymap).bindPopup("<b>You're safe here!</b>");

    }

    else{

      alert("Tá blz meu chegado");

    }
  }

  mymap.on('click', onMapClick);

</script>
  
</body>
</html>





